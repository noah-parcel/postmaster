<!DOCTYPE html>
<html>
<body>
<h2>Word Finder Game</h2>

<!-- Display -->
<p>Next Letter: <span id="nextLetter"></span></p>
<p>Time Left: <span id="timeLeft">30</span> seconds</p>
<p>Score: <span id="score">0</span></p>

<!-- Game board -->
<div id="gameBoard"></div>

<!-- Found words -->
<h3>Found words:</h3>
<div id="foundWords"></div>

<script>
let validWords = []; // Will hold valid words from valid-words.txt
let nextLetter = ""; // The next letter to be added to the grid
let timeLeft = 30; // Countdown timer
let score = 0; // Player's score
let timer; // For starting and stopping the countdown timer

let gameBoard = Array(4).fill().map(() => Array(4).fill(""));

// Fetch the valid words
fetch("valid-words.txt")
    .then(response => response.text())
    .then(data => {
        validWords = data.split('\n');
        validWords = validWords.map(word => word.trim().toUpperCase());
        resetGame();
    });

function resetGame() {
    clearInterval(timer); // Clear interval
    nextLetter = generateRandomLetter(); // Generate a new next letter
    document.getElementById('nextLetter').innerText = nextLetter;
    // Fill and display the game board
    document.getElementById('gameBoard').innerHTML = gameBoard
        .map((row, i) => `<div>${row.map((cell, j) => `<span style="border: 1px solid; padding: 5px; cursor: pointer;" onclick='addLetterToBoard(${i}, ${j})'>${cell}</span>`).join('')}</div>`)
        .join('');
    timeLeft = 30;
    timer = setInterval(updateTimer, 1000); // Start countdown
}

function addLetterToBoard(i, j) {
    // Add next letter to cell and generate a new next letter
    gameBoard[i][j] = nextLetter;
    nextLetter = generateRandomLetter();
    document.getElementById('nextLetter').innerText = nextLetter;
    // Update the board
    document.getElementById('gameBoard').innerHTML = gameBoard
        .map((row, i) => `<div>${row.map((cell, j) => `<span style="border: 1px solid; padding: 5px; cursor: pointer;" onclick='addLetterToBoard(${i}, ${j})'>${cell}</span>`).join('')}</div>`)
        .join('');
    // Check the board for new words
    let foundWords = findWordsInBoard(gameBoard);
    foundWords.forEach(word => {
        if (!document.getElementById('foundWords').innerText.includes(word)) {
            // If word hasn't been found before and it's 3 to 4 letters long, add to score and display it
            document.getElementById('foundWords').innerText += `${word}\n`;
            score += word.length - 2; // 3-letter words score 1 point, 4-letter words score 2 points
            document.getElementById('score').innerText = score;
        }
    });
    resetGame();
}

function findWordsInBoard(board) {
    // Flatten board into a string of letters
    let string = board.reduce((acc, val) => acc.concat(val), []).join('');
    // Find valid words in the string
    return validWords.filter(word => string.includes(word) && word.length >= 3 && word.length <= 4);
}

function generateRandomLetter() {
    return String.fromCharCode(65 + Math.floor(Math.random() * 26));
}

function updateTimer() {
    timeLeft--;
    document.getElementById('timeLeft').innerText = timeLeft;
    if (timeLeft <= 0) {
        resetGame();
    }
}
</script>

</body>
</html>
